{% extends "base.html" %}
{% block title %}{{ company.name }} â€” CRM Extender{% endblock %}

{% block content %}
<h1>{{ company.name }}</h1>

<div class="grid">
  <div>
    <h2>Contacts ({{ contacts|length }})</h2>
    {% if contacts %}
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
        </tr>
      </thead>
      <tbody>
        {% for c in contacts %}
        <tr>
          <td><a href="/contacts/{{ c.id }}">{{ c.name or '(unnamed)' }}</a></td>
          <td>{{ c.email or '' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="empty-state">No contacts linked to this company.</p>
    {% endif %}

    {% if relationships %}
    <h2>Relationships ({{ relationships|length }})</h2>
    <table>
      <thead>
        <tr>
          <th>Label</th>
          <th>Entity</th>
          <th>Type</th>
          <th>Source</th>
        </tr>
      </thead>
      <tbody>
        {% for rel in relationships %}
        <tr>
          <td><em>{{ rel.label }}</em></td>
          <td>
            {% if rel.other_entity_type == 'contact' %}
            <a href="/contacts/{{ rel.other_id }}">{{ rel.other_name }}</a>
            {% else %}
            <a href="/companies/{{ rel.other_id }}">{{ rel.other_name }}</a>
            {% endif %}
          </td>
          <td>{{ rel.type_name }}</td>
          <td>{{ rel.source }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}

    {% include "companies/_identifiers.html" %}

    {% include "companies/_hierarchy.html" %}

    {% include "companies/_phones.html" %}

    {% include "companies/_emails.html" %}

    {% include "companies/_addresses.html" %}
  </div>

  <div>
    <article>
      <header>
        Company Info
        <span style="float:right;">
          {% if company.domain or company.website %}
          <button hx-post="/companies/{{ company.id }}/enrich"
                  hx-indicator="#enrich-spinner"
                  class="outline"
                  style="padding:4px 12px;font-size:.85em;margin-right:4px;">
            Enrich
          </button>
          <span id="enrich-spinner" class="htmx-indicator" style="font-size:.85em;">enriching...</span>
          {% endif %}
          <a href="/companies/{{ company.id }}/edit" role="button" class="outline"
             style="padding:4px 12px;font-size:.85em;">Edit</a>
        </span>
      </header>
      <dl class="detail-sidebar">
        {% if company.domain %}
        <dt>Domain</dt>
        <dd>{{ company.domain }}</dd>
        {% endif %}
        {% if company.website %}
        <dt>Website</dt>
        <dd><a href="{{ company.website }}" target="_blank" rel="noopener">{{ company.website }}</a></dd>
        {% endif %}
        {% if company.industry %}
        <dt>Industry</dt>
        <dd>{{ company.industry }}</dd>
        {% endif %}
        {% if company.description %}
        <dt>Description</dt>
        <dd>{{ company.description }}</dd>
        {% endif %}
        {% if company.stock_symbol %}
        <dt>Stock Symbol</dt>
        <dd>{{ company.stock_symbol }}</dd>
        {% endif %}
        {% if company.headquarters_location %}
        <dt>Headquarters</dt>
        <dd>{{ company.headquarters_location }}</dd>
        {% endif %}
        {% if company.size_range %}
        <dt>Size Range</dt>
        <dd>{{ company.size_range }}</dd>
        {% endif %}
        {% if company.employee_count %}
        <dt>Employee Count</dt>
        <dd>{{ company.employee_count }}</dd>
        {% endif %}
        {% if company.founded_year %}
        <dt>Founded</dt>
        <dd>{{ company.founded_year }}</dd>
        {% endif %}
        {% if company.revenue_range %}
        <dt>Revenue Range</dt>
        <dd>{{ company.revenue_range }}</dd>
        {% endif %}
        {% if company.funding_total %}
        <dt>Funding Total</dt>
        <dd>{{ company.funding_total }}</dd>
        {% endif %}
        {% if company.funding_stage %}
        <dt>Funding Stage</dt>
        <dd>{{ company.funding_stage }}</dd>
        {% endif %}
        <dt>Status</dt>
        <dd>{{ company.status or 'active' }}</dd>
      </dl>
      {% if social_profiles %}
      <hr>
      <h3>Social Profiles</h3>
      <ul>
        {% for sp in social_profiles %}
        <li>
          <strong>{{ sp.platform }}</strong>:
          <a href="{{ sp.profile_url }}" target="_blank" rel="noopener">{{ sp.username or sp.profile_url }}</a>
        </li>
        {% endfor %}
      </ul>
      {% endif %}
    </article>
  </div>
</div>
{% endblock %}
