{% extends "base.html" %}
{% block title %}Companies â€” CRM Extender{% endblock %}

{% block content %}
<h1>Companies <small>({{ companies|length }})</small></h1>

<div class="grid">
  <div>
    {% set sc = scope|default('all', true) %}
    <div style="margin-bottom: 1rem;">
      <div class="grid" style="max-width: 200px;">
        <a href="/companies?scope=all" role="button"
           class="{{ 'secondary' if sc == 'mine' else '' }}"
           style="padding: .4rem .8rem; font-size: .85rem;">All</a>
        <a href="/companies?scope=mine" role="button"
           class="{{ 'secondary' if sc != 'mine' else '' }}"
           style="padding: .4rem .8rem; font-size: .85rem;">Mine</a>
      </div>
    </div>

    <div class="search-bar">
      <input type="search" name="q" value="{{ q }}"
             placeholder="Search name or domain..."
             hx-get="/companies/search"
             hx-trigger="input changed delay:300ms, search"
             hx-target="#results"
             hx-vals='{"sort": "{{ sort|default('name', true) }}", "scope": "{{ sc }}"}'
             hx-push-url="/companies">
      <span class="htmx-indicator" aria-busy="true"></span>
    </div>

    <div style="margin-bottom: 1rem;">
      <button hx-post="/companies/resolve-domains"
              hx-target="#resolve-result"
              hx-swap="innerHTML"
              class="outline">Resolve Domains</button>
      <a href="/companies/duplicates" role="button" class="outline"
         style="margin-left: 0.5rem;">Scan Duplicates</a>
      <span id="resolve-result" style="margin-left: 0.5rem;"></span>
    </div>

    <div id="results">
      {% include "companies/_rows.html" %}
    </div>
  </div>

  <div id="company-form-area">
    <article>
      <header>New Company</header>
      {% include "companies/_form.html" %}
    </article>
  </div>
</div>
{% endblock %}
