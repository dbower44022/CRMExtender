<div id="conversations-section">
  <div style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:0.5rem;">
    <h2 style="margin:0;">Conversations ({{ conversations|length }})</h2>
    <form method="post" action="/contacts/{{ contact.id }}/sync-email"
          hx-post="/contacts/{{ contact.id }}/sync-email"
          hx-target="#conversations-section"
          hx-swap="outerHTML"
          hx-indicator="#sync-spinner"
          style="display:flex; align-items:center; gap:0.5rem; margin:0;">
      <select name="window" style="margin:0; padding:4px 8px; width:auto; min-width:120px;">
        {% for value, label in email_history_options %}
        <option value="{{ value }}">{{ label }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="outline" style="padding:4px 12px; font-size:.85em; margin:0; white-space:nowrap;">
        Sync Email
      </button>
      <span id="sync-spinner" class="htmx-indicator" aria-busy="true" style="display:none;"></span>
    </form>
  </div>

  {% if sync_result %}
  <article style="padding:0.5rem 1rem; background:var(--pico-ins-color); margin-top:0.5rem;">
    <p style="margin:0;">
      Sync complete: {{ sync_result.messages_fetched }} messages fetched,
      {{ sync_result.conversations_created }} conversations created,
      {{ sync_result.conversations_updated }} updated.
    </p>
  </article>
  {% endif %}
  {% if sync_error %}
  <article style="padding:0.5rem 1rem; background:var(--pico-del-color); margin-top:0.5rem;">
    <p style="margin:0;">Sync error: {{ sync_error }}</p>
  </article>
  {% endif %}

  {% if conversations %}
  <table>
    <thead>
      <tr>
        <th>Subject</th>
        <th>Status</th>
        <th>Last Activity</th>
      </tr>
    </thead>
    <tbody>
      {% for conv in conversations %}
      <tr>
        <td><a href="/conversations/{{ conv.id }}">{{ conv.title or '(no subject)' }}</a></td>
        <td>{{ conv.ai_status or conv.status or 'active' }}</td>
        <td>{{ conv.last_activity_at|datetime }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="empty-state">No conversations.</p>
  {% endif %}
</div>
