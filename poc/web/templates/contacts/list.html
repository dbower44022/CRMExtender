{% extends "base.html" %}
{% block title %}Contacts â€” CRM Extender{% endblock %}

{% block content %}
<h1>Contacts <small>({{ total }})</small></h1>

{% set sc = scope|default('all', true) %}
<div style="margin-bottom: 1rem; display: flex; align-items: center; gap: 1rem;">
  <div class="grid" style="max-width: 200px; margin-bottom: 0;">
    <a href="/contacts?scope=all" role="button"
       class="{{ 'secondary' if sc == 'mine' else '' }}"
       style="padding: .4rem .8rem; font-size: .85rem;">All</a>
    <a href="/contacts?scope=mine" role="button"
       class="{{ 'secondary' if sc != 'mine' else '' }}"
       style="padding: .4rem .8rem; font-size: .85rem;">Mine</a>
  </div>
  <a href="/contacts/import" role="button" class="outline"
     style="padding: .4rem .8rem; font-size: .85rem;">Import vCards</a>
</div>

<div id="merge-toolbar" style="display:none; margin-bottom:1rem;">
  <button id="merge-btn" onclick="mergeSelected()" class="contrast" style="padding:.4rem 1rem;font-size:.85rem;">
    Merge Selected (<span class="selected-count">0</span>)
  </button>
  <button id="relate-btn" onclick="relateSelected()" class="outline" style="padding:.4rem 1rem;font-size:.85rem;margin-left:.5rem;">
    Create Relationship (<span class="selected-count">0</span>)
  </button>
</div>

<div class="search-bar">
  <input type="search" name="q" value="{{ q }}"
         placeholder="Search name, email, or company..."
         hx-get="/contacts/search"
         hx-trigger="input changed delay:300ms, search"
         hx-target="#results"
         hx-vals='{"sort": "{{ sort|default('name', true) }}", "scope": "{{ sc }}"}'
         hx-push-url="/contacts">
  <span class="htmx-indicator" aria-busy="true"></span>
</div>

<div id="results">
  {% include "contacts/_rows.html" %}
</div>

<script src="/static/contact_merge.js"></script>
{% endblock %}
