{% from "_grid_macros.html" import grid_headers, grid_cells, grid_pagination %}
{% set s = sort|default('', true) %}
{% if rows %}
<table class="events-table">
  <thead>
    <tr>
      {{ grid_headers(view, entity_def, s, "/events/search", {"q": q|default('', true), "event_type": event_type|default('', true)}) }}
      <th></th><th></th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr id="event-{{ row.id }}">
      {{ grid_cells(row, view, entity_def) }}
      <td>{{ row.source|source_icon(row.account_name, row.provider_calendar_id) }}</td>
      <td>
        <button class="outline secondary"
                style="padding:0.2rem 0.5rem;font-size:0.75rem"
                hx-delete="/events/{{ row.id }}"
                hx-target="#event-{{ row.id }}"
                hx-swap="outerHTML"
                hx-confirm="Delete event '{{ row.title }}'?">Delete</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{{ grid_pagination(page, total_pages, "/events",
                    {"q": q|default('', true), "sort": s, "event_type": event_type|default('', true)}) }}
{% else %}
<p class="empty-state">No events found.</p>
{% endif %}
