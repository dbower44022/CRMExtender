{% extends "base.html" %}
{% block title %}Events â€” CRM Extender{% endblock %}

{% block content %}
<div style="display:flex; align-items:center; gap:1rem; margin-bottom:1rem;">
  <h1 style="margin:0;">Events <small>({{ total }})</small></h1>
  <button
    hx-post="/events/sync"
    hx-target="#sync-result"
    hx-indicator="#sync-spinner"
    class="secondary outline"
    style="margin-left:auto; white-space:nowrap;"
  >Sync Events</button>
  <span id="sync-spinner" class="htmx-indicator" aria-busy="true"></span>
</div>

<div id="sync-result" style="margin-bottom:1rem;"></div>

<div class="grid">
  <div>
    <div class="search-bar">
      <input type="search" name="q" value="{{ q }}"
             placeholder="Search title or location..."
             hx-get="/events/search"
             hx-trigger="input changed delay:300ms, search"
             hx-target="#results"
             hx-include="[name='event_type']"
             hx-push-url="/events">
      <select name="event_type"
              hx-get="/events/search"
              hx-trigger="change"
              hx-target="#results"
              hx-include=".search-bar">
        <option value="">All types</option>
        <option value="meeting" {% if event_type == 'meeting' %}selected{% endif %}>Meeting</option>
        <option value="birthday" {% if event_type == 'birthday' %}selected{% endif %}>Birthday</option>
        <option value="anniversary" {% if event_type == 'anniversary' %}selected{% endif %}>Anniversary</option>
        <option value="conference" {% if event_type == 'conference' %}selected{% endif %}>Conference</option>
        <option value="deadline" {% if event_type == 'deadline' %}selected{% endif %}>Deadline</option>
        <option value="other" {% if event_type == 'other' %}selected{% endif %}>Other</option>
      </select>
      <span class="htmx-indicator" aria-busy="true"></span>
    </div>

    <div id="results" hx-trigger="refreshEvents from:body" hx-get="/events/search" hx-include=".search-bar">
      {% include "events/_rows.html" %}
    </div>
  </div>

  <div id="event-form-area">
    <article>
      <header>New Event</header>
      {% include "events/_form.html" %}
    </article>
  </div>
</div>
{% endblock %}
